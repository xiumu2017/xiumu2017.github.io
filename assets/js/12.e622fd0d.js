(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{517:function(s,a,n){"use strict";n.r(a);var t=n(6),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("em",[n("strong",[s._v("Springboot + Indy-SDK 镜像搭建")])])]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#解析-wattazoum-springboot-runner"}},[s._v("解析 wattazoum/springboot-runner")])]),n("li",[n("a",{attrs:{href:"#集成-springboot-runner-和-indy-sdk"}},[s._v("集成 springboot-runner 和 indy-sdk")])]),n("li",[n("a",{attrs:{href:"#遇到的问题"}},[s._v("遇到的问题")]),n("ul",[n("li",[n("a",{attrs:{href:"#permission-denied-unknown"}},[s._v("permission denied: unknown")])]),n("li",[n("a",{attrs:{href:"#source-not-found"}},[s._v("source: not found")])]),n("li",[n("a",{attrs:{href:"#启动报错-无法连接-nacos-mysql-等其他容器"}},[s._v("启动报错，无法连接 nacos mysql 等其他容器")])])])])])]),n("p"),s._v(" "),n("p",[s._v("我们项目一直用的一个 SpringBoot Docker 镜像： "),n("code",[s._v("wattazoum/springboot-runner")]),n("br"),s._v("\nDockerHub 地址： "),n("a",{attrs:{href:"https://hub.docker.com/r/wattazoum/springboot-runner",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://hub.docker.com/r/wattazoum/springboot-runner"),n("OutboundLink")],1),n("br"),s._v("\n简单介绍：")]),s._v(" "),n("blockquote",[n("p",[s._v("Based on "),n("a",{attrs:{href:"https://hub.docker.com/_/openjdk/",target:"_blank",rel:"noopener noreferrer"}},[s._v("openjdk:8u121-jre-alpine"),n("OutboundLink")],1),s._v(" docker image."),n("br"),s._v("\nThis image is more that just a "),n("a",{attrs:{href:"https://projects.spring.io/spring-boot/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Spring Boot"),n("OutboundLink")],1),s._v(" runner. I can launch any java command."),n("br"),s._v("\nI created it first because I needed to launch a spring boot application in a container."),n("br"),s._v("\nBut I didn't want to:")]),s._v(" "),n("ul",[n("li",[s._v("recreate an image for every version")]),s._v(" "),n("li",[s._v("customize the docker run command per environment.")])])]),s._v(" "),n("p",[s._v("因为我们 凭证管理系统App 的接口中需要用到 indy-sdk ，但是官方并没有提供在 docker 容器中安装配置的方法，只能自己去自定义镜像。")]),s._v(" "),n("p",[s._v("参考已有的 indy-sdk Dockerfile：")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("bionic\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" author\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y gnupg2 software"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("properties"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("common\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("key adv "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keyserver keyserver.ubuntu.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("recv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keys CE7709D068DB5E88\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repository "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb https://repo.sovrin.org/sdk/deb bionic stable"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y libindy\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v(" 省略一些 Python 命令\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" adduser indy\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'indy:indypasswd'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" chpasswd\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir /app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R indy /app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" indy\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("可以看到这个镜像是基于 "),n("code",[s._v("ubuntu:bionic")]),s._v(" ，那么我们就可以在 Ubuntu Os 镜像的基础上安装配置 Java 环境，集成已有的 SpringBoot-Runner，那么，我们就需要先分析 springboot-runner 的实现。")]),s._v(" "),n("h2",{attrs:{id:"解析-wattazoum-springboot-runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解析-wattazoum-springboot-runner"}},[s._v("#")]),s._v(" 解析 "),n("code",[s._v("wattazoum/springboot-runner")])]),s._v(" "),n("p",[s._v("Github 地址："),n("a",{attrs:{href:"https://github.com/wattazoum/docker-springboot-runner",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/wattazoum/docker-springboot-runner"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("可以看到，核心文件就是一个 Dockerfile 和一个脚本文件 "),n("code",[s._v("entrypoint.sh")])]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8u121"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jre"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Oumar Aziz OUATTARA (wattazoum)\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk update && apk add fontconfig ttf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dejavu\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" adduser "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("S "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u 1000 springboot && \\\n    mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /app && \\\n    chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R springboot /app\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" entrypoint.sh /usr/local/bin/\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" springboot\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" /app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/entrypoint.sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# In case the user wants only to use java with options")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$#")]),s._v(" -gt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" java "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Behavior when using the /app folder")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# In the setenv.sh file you may define the following environment")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# variables")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JAVA_OPTS : a string containing the list of java options to ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#             pass to the java command.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#             eg. JAVA_OPTS="-Xmx1g -Dfile.encoding=utf8"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# APP_ARGS")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SETENV_FILE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/app/setenv.sh\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -r "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SETENV_FILE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SETENV_FILE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMP_JARS_LIST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/jars_list \n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /app -maxdepth "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -regex "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.*.[jw]ar$'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TMP_JARS_LIST")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nb_jars")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $TMP_JARS_LIST "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nb_jars")]),s._v(" -gt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ERROR: You may only have one jar/war in the /app folder'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'==================================================='")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TMP_JARS_LIST")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nb_jars")]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ERROR: There should be one and only one jar/war in the /app folder'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'=============================================================='")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CMD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_OPTS")]),s._v(" -jar "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $TMP_JARS_LIST"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_ARGS")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Launching the following command:"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"  |"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" '  `-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  '"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CMD")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CMD")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br")])]),n("ul",[n("li",[s._v("通过 source 命令，写入配置文件的内容到环境变量")]),s._v(" "),n("li",[s._v("判断 /app 目录下 jar 包的数量\n"),n("ul",[n("li",[s._v("多于 1 个，报错")]),s._v(" "),n("li",[s._v("少于 1 个，报错")])])]),s._v(" "),n("li",[s._v("执行 "),n("code",[s._v("java -jar")]),s._v(" 命令")])]),s._v(" "),n("p",[s._v("核心就是 Java 环境和 "),n("code",[s._v("java -jar")]),s._v(" CMD")]),s._v(" "),n("h2",{attrs:{id:"集成-springboot-runner-和-indy-sdk"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集成-springboot-runner-和-indy-sdk"}},[s._v("#")]),s._v(" 集成 springboot-runner 和 indy-sdk")]),s._v(" "),n("p",[s._v("基于 Ubuntu 镜像，安装 indy-sdk、安装 Jdk 、执行 "),n("code",[s._v("java -jar")]),s._v(" CMD")]),s._v(" "),n("p",[s._v("目录结构：\n"),n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/159222/1619404778512-3eaf24c7-3526-4051-bc23-ce4c9543bbe2.png#clientId=u2bb91da8-87d2-4&from=paste&height=101&id=u6904e306&margin=%5Bobject%20Object%5D&name=image.png&originHeight=201&originWidth=769&originalType=binary&size=28226&status=done&style=none&taskId=u867e1922-cf17-44c9-91bf-d1e08fa4272&width=384.5",alt:"image.png"}}),s._v("\n/app-docker")]),s._v(" "),n("ul",[n("li",[s._v("/app")]),s._v(" "),n("li",[s._v("docker-compose.yml")]),s._v(" "),n("li",[s._v("Dockerfile")]),s._v(" "),n("li",[s._v("entrypoint.sh")])]),s._v(" "),n("p",[n("code",[s._v("entrypoint.sh")]),s._v(" 脚本文件复制上面 runner 的即可；")]),s._v(" "),n("p",[s._v("Dockerfile 配置：")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("bionic\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" dongzhang@gaoshan.co\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y gnupg2 software"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("properties"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("common\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("key adv "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keyserver keyserver.ubuntu.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("recv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keys CE7709D068DB5E88 \\\n && add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repository "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb https://repo.sovrin.org/sdk/deb bionic stable"')]),s._v(" \\\n && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update \\\n && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y libindy\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk \\\n && java "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("version\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" adduser indy \\\n && echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'indy:indypasswd'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" chpasswd \\\n && mkdir /app \\\n && chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R indy /app\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" entrypoint.sh /usr/local/bin/\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" chmod +x /usr/local/bin/entrypoint.sh\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" indy\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" /app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/entrypoint.sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("p",[s._v("docker-compose.yml 配置参考：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cert-app-center")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerfile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Dockerfile\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wattazoum/springboot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("runner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("local\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("center\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  restart: always")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stdin_open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8084"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8084")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./cert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("center/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/mnt/logs\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./cert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("center"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/app\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TZ=\"Asia/Shanghai\"'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" default\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cert_default\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h2",{attrs:{id:"遇到的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[s._v("#")]),s._v(" 遇到的问题")]),s._v(" "),n("h3",{attrs:{id:"permission-denied-unknown"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#permission-denied-unknown"}},[s._v("#")]),s._v(" permission denied: unknown")]),s._v(" "),n("p",[s._v('OCI runtime create failed: container_linux.go:370: starting container process caused: exec: "/usr/local/bin/entrypoint.sh": permission denied: unknown')]),s._v(" "),n("p",[s._v("解决方案：\nDockerfile 增加 "),n("code",[s._v("RUN chmod +x /usr/local/bin/entrypoint.sh")])]),s._v(" "),n("h3",{attrs:{id:"source-not-found"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#source-not-found"}},[s._v("#")]),s._v(" source: not found")]),s._v(" "),n("p",[s._v("解决方案：\n修改 entrypoint.sh 文件头 #!/bin")]),s._v(" "),n("blockquote",[n("p",[s._v('例如，我装java，解压之后配置环境变量，因为用的是Docker ubuntu自带的终端执行的命令，所以修改的是~/.bashrc文件，修改完了之后要用source命令生效：\nSource ~/.bashrc：报：/bin/sh: 28: source: not found\n查了下，说是sh 和 bash 是不同的 shell，sh 中没有 source 命令，解决的方法是：\n/bin/bash -c "source 要执行的原内容”\n若是要执行shell脚本中的该命令，则在 shell 脚本的第一行加上一行 "#!/bin/bash" 即可。这一行指定了shell 脚本解释器的路径，而且这个指定路径 只能放在文件的第一行。')])]),s._v(" "),n("h3",{attrs:{id:"启动报错-无法连接-nacos-mysql-等其他容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动报错-无法连接-nacos-mysql-等其他容器"}},[s._v("#")]),s._v(" 启动报错，无法连接 nacos mysql 等其他容器")]),s._v(" "),n("p",[s._v("解决方案：\n修改了 docker-compose.yml ，增加 networks 相关的配置")]),s._v(" "),n("p",[s._v("原因尚不清楚，还有很多需要学习的；")])])}),[],!1,null,null,null);a.default=e.exports}}]);