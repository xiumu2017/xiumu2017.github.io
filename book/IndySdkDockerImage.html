<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot + Indy-SDK 镜像搭建 | Paradise VuePress</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/image/1.ico">
    <meta name="description" content="Paradise Blog By VuePress">
    
    <link rel="preload" href="/assets/css/0.styles.a5fc1f3a.css" as="style"><link rel="preload" href="/assets/js/app.70f464a8.js" as="script"><link rel="preload" href="/assets/js/3.5e14ac70.js" as="script"><link rel="preload" href="/assets/js/1.b7eef7cf.js" as="script"><link rel="preload" href="/assets/js/12.e622fd0d.js" as="script"><link rel="prefetch" href="/assets/js/10.6e61ae38.js"><link rel="prefetch" href="/assets/js/11.ca09bff4.js"><link rel="prefetch" href="/assets/js/13.2323f373.js"><link rel="prefetch" href="/assets/js/14.36ce022e.js"><link rel="prefetch" href="/assets/js/15.93d8d9f6.js"><link rel="prefetch" href="/assets/js/16.cc5f77d2.js"><link rel="prefetch" href="/assets/js/17.6aa5a8cd.js"><link rel="prefetch" href="/assets/js/18.7dbe1dce.js"><link rel="prefetch" href="/assets/js/19.f37af9c3.js"><link rel="prefetch" href="/assets/js/20.a1f1c49a.js"><link rel="prefetch" href="/assets/js/21.dee4a6f9.js"><link rel="prefetch" href="/assets/js/22.c5cb6dd9.js"><link rel="prefetch" href="/assets/js/23.b43d5fa5.js"><link rel="prefetch" href="/assets/js/4.a2c2d6a9.js"><link rel="prefetch" href="/assets/js/5.5051888e.js"><link rel="prefetch" href="/assets/js/6.3d0ac4b7.js"><link rel="prefetch" href="/assets/js/7.fe4e97c6.js"><link rel="prefetch" href="/assets/js/8.89b91e7a.js"><link rel="prefetch" href="/assets/js/9.66d4515e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5fc1f3a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Paradise VuePress</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>Paradise Blog By VuePress</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Paradise</span>
            
          <span data-v-4e82dffc>2018 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Paradise VuePress</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/book/" class="nav-link router-link-active"><i class="iconfont reco-douyin"></i>
  Book
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/区块链/" class="nav-link"><i class="undefined"></i>
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/categories/读书/" class="nav-link"><i class="undefined"></i>
  读书
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/收藏/" class="nav-link"><i class="undefined"></i>
  收藏
</a></li><li class="dropdown-item"><!----> <a href="/categories/starter/" class="nav-link"><i class="undefined"></i>
  starter
</a></li><li class="dropdown-item"><!----> <a href="/categories/default/" class="nav-link"><i class="undefined"></i>
  default
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="https://www.yuque.com/paradise" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-twitter"></i>
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/xiumu2017/VuePressParadise" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/image/avatar.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Paradise
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>7</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>6</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/book/" class="nav-link router-link-active"><i class="iconfont reco-douyin"></i>
  Book
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/区块链/" class="nav-link"><i class="undefined"></i>
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/categories/读书/" class="nav-link"><i class="undefined"></i>
  读书
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/收藏/" class="nav-link"><i class="undefined"></i>
  收藏
</a></li><li class="dropdown-item"><!----> <a href="/categories/starter/" class="nav-link"><i class="undefined"></i>
  starter
</a></li><li class="dropdown-item"><!----> <a href="/categories/default/" class="nav-link"><i class="undefined"></i>
  default
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="https://www.yuque.com/paradise" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-twitter"></i>
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/xiumu2017/VuePressParadise" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>SpringBoot + Indy-SDK 镜像搭建</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Paradise</span>
            
          <span data-v-4e82dffc>2018 - </span>
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">SpringBoot + Indy-SDK 镜像搭建</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Paradise</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>4/25/2021</span></i> <i class="iconfont reco-eye" data-v-1ff7123e><span id="/book/IndySdkDockerImage.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-1ff7123e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>docker</span><span class="tag-item" data-v-1ff7123e>区块链</span></i></div></div> <div class="theme-reco-content content__default"><p><em><strong>Springboot + Indy-SDK 镜像搭建</strong></em></p> <p></p><div class="table-of-contents"><ul><li><a href="#解析-wattazoum-springboot-runner">解析 wattazoum/springboot-runner</a></li><li><a href="#集成-springboot-runner-和-indy-sdk">集成 springboot-runner 和 indy-sdk</a></li><li><a href="#遇到的问题">遇到的问题</a><ul><li><a href="#permission-denied-unknown">permission denied: unknown</a></li><li><a href="#source-not-found">source: not found</a></li><li><a href="#启动报错-无法连接-nacos-mysql-等其他容器">启动报错，无法连接 nacos mysql 等其他容器</a></li></ul></li></ul></div><p></p> <p>我们项目一直用的一个 SpringBoot Docker 镜像： <code>wattazoum/springboot-runner</code><br>
DockerHub 地址： <a href="https://hub.docker.com/r/wattazoum/springboot-runner" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/wattazoum/springboot-runner<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
简单介绍：</p> <blockquote><p>Based on <a href="https://hub.docker.com/_/openjdk/" target="_blank" rel="noopener noreferrer">openjdk:8u121-jre-alpine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> docker image.<br>
This image is more that just a <a href="https://projects.spring.io/spring-boot/" target="_blank" rel="noopener noreferrer">Spring Boot<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> runner. I can launch any java command.<br>
I created it first because I needed to launch a spring boot application in a container.<br>
But I didn't want to:</p> <ul><li>recreate an image for every version</li> <li>customize the docker run command per environment.</li></ul></blockquote> <p>因为我们 凭证管理系统App 的接口中需要用到 indy-sdk ，但是官方并没有提供在 docker 容器中安装配置的方法，只能自己去自定义镜像。</p> <p>参考已有的 indy-sdk Dockerfile：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>bionic
<span class="token keyword">MAINTAINER</span> author
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y gnupg2 software<span class="token punctuation">-</span>properties<span class="token punctuation">-</span>common
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>key adv <span class="token punctuation">-</span><span class="token punctuation">-</span>keyserver keyserver.ubuntu.com <span class="token punctuation">-</span><span class="token punctuation">-</span>recv<span class="token punctuation">-</span>keys CE7709D068DB5E88
<span class="token keyword">RUN</span> add<span class="token punctuation">-</span>apt<span class="token punctuation">-</span>repository <span class="token string">&quot;deb https://repo.sovrin.org/sdk/deb bionic stable&quot;</span>
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y libindy
 <span class="token punctuation">...</span> 省略一些 Python 命令
<span class="token keyword">RUN</span> adduser indy
<span class="token keyword">RUN</span> echo <span class="token string">'indy:indypasswd'</span> <span class="token punctuation">|</span> chpasswd
<span class="token keyword">RUN</span> mkdir /app
<span class="token keyword">RUN</span> chown <span class="token punctuation">-</span>R indy /app
<span class="token keyword">USER</span> indy
<span class="token keyword">WORKDIR</span> /app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>可以看到这个镜像是基于 <code>ubuntu:bionic</code> ，那么我们就可以在 Ubuntu Os 镜像的基础上安装配置 Java 环境，集成已有的 SpringBoot-Runner，那么，我们就需要先分析 springboot-runner 的实现。</p> <h2 id="解析-wattazoum-springboot-runner"><a href="#解析-wattazoum-springboot-runner" class="header-anchor">#</a> 解析 <code>wattazoum/springboot-runner</code></h2> <p>Github 地址：<a href="https://github.com/wattazoum/docker-springboot-runner" target="_blank" rel="noopener noreferrer">https://github.com/wattazoum/docker-springboot-runner<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>可以看到，核心文件就是一个 Dockerfile 和一个脚本文件 <code>entrypoint.sh</code></p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> openjdk<span class="token punctuation">:</span>8u121<span class="token punctuation">-</span>jre<span class="token punctuation">-</span>alpine
<span class="token keyword">MAINTAINER</span> Oumar Aziz OUATTARA (wattazoum)

<span class="token keyword">RUN</span> apk update &amp;&amp; apk add fontconfig ttf<span class="token punctuation">-</span>dejavu

<span class="token keyword">RUN</span> adduser <span class="token punctuation">-</span>S <span class="token punctuation">-</span>u 1000 springboot &amp;&amp; \
    mkdir <span class="token punctuation">-</span>p /app &amp;&amp; \
    chown <span class="token punctuation">-</span>R springboot /app

<span class="token keyword">ADD</span> entrypoint.sh /usr/local/bin/

<span class="token keyword">USER</span> springboot

<span class="token keyword">WORKDIR</span> /app

<span class="token keyword">VOLUME</span> /app
<span class="token keyword">EXPOSE</span> 8080

<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/local/bin/entrypoint.sh&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">set</span> -e

<span class="token comment"># In case the user wants only to use java with options</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -gt <span class="token number">0</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token builtin class-name">exec</span> java <span class="token variable">$@</span>
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">fi</span>

<span class="token comment"># Behavior when using the /app folder</span>
<span class="token comment">#</span>
<span class="token comment"># In the setenv.sh file you may define the following environment</span>
<span class="token comment"># variables</span>
<span class="token comment">#</span>
<span class="token comment"># JAVA_OPTS : a string containing the list of java options to </span>
<span class="token comment">#             pass to the java command.</span>
<span class="token comment">#             eg. JAVA_OPTS=&quot;-Xmx1g -Dfile.encoding=utf8&quot;</span>
<span class="token comment"># APP_ARGS</span>

<span class="token assign-left variable">SETENV_FILE</span><span class="token operator">=</span>/app/setenv.sh

<span class="token keyword">if</span> <span class="token punctuation">[</span> -r <span class="token variable">$SETENV_FILE</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token builtin class-name">source</span> <span class="token variable">$SETENV_FILE</span>
<span class="token keyword">fi</span>


<span class="token assign-left variable">TMP_JARS_LIST</span><span class="token operator">=</span>/tmp/jars_list 

<span class="token function">find</span> /app -maxdepth <span class="token number">1</span> -regex <span class="token string">'.*.[jw]ar$'</span> <span class="token operator">&gt;</span> <span class="token variable">$TMP_JARS_LIST</span>
<span class="token assign-left variable">nb_jars</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $TMP_JARS_LIST <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$nb_jars</span> -gt <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'ERROR: You may only have one jar/war in the /app folder'</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'==================================================='</span>
    <span class="token function">cat</span> <span class="token variable">$TMP_JARS_LIST</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$nb_jars</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'ERROR: There should be one and only one jar/war in the /app folder'</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'=============================================================='</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">else</span> 
    <span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token string">&quot;java <span class="token variable">$JAVA_OPTS</span> -jar <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $TMP_JARS_LIST<span class="token variable">)</span></span> <span class="token variable">$APP_ARGS</span>&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Launching the following command:&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;  |&quot;</span>
    <span class="token builtin class-name">echo</span> '  `-<span class="token operator">&gt;</span>  '<span class="token string">&quot;<span class="token variable">$CMD</span>&quot;</span>
    <span class="token builtin class-name">echo</span> 
    <span class="token builtin class-name">exec</span> <span class="token variable">$CMD</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">exit</span> <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><ul><li>通过 source 命令，写入配置文件的内容到环境变量</li> <li>判断 /app 目录下 jar 包的数量
<ul><li>多于 1 个，报错</li> <li>少于 1 个，报错</li></ul></li> <li>执行 <code>java -jar</code> 命令</li></ul> <p>核心就是 Java 环境和 <code>java -jar</code> CMD</p> <h2 id="集成-springboot-runner-和-indy-sdk"><a href="#集成-springboot-runner-和-indy-sdk" class="header-anchor">#</a> 集成 springboot-runner 和 indy-sdk</h2> <p>基于 Ubuntu 镜像，安装 indy-sdk、安装 Jdk 、执行 <code>java -jar</code> CMD</p> <p>目录结构：
<img src="https://cdn.nlark.com/yuque/0/2021/png/159222/1619404778512-3eaf24c7-3526-4051-bc23-ce4c9543bbe2.png#clientId=u2bb91da8-87d2-4&amp;from=paste&amp;height=101&amp;id=u6904e306&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=201&amp;originWidth=769&amp;originalType=binary&amp;size=28226&amp;status=done&amp;style=none&amp;taskId=u867e1922-cf17-44c9-91bf-d1e08fa4272&amp;width=384.5" alt="image.png">
/app-docker</p> <ul><li>/app</li> <li>docker-compose.yml</li> <li>Dockerfile</li> <li>entrypoint.sh</li></ul> <p><code>entrypoint.sh</code> 脚本文件复制上面 runner 的即可；</p> <p>Dockerfile 配置：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>bionic
<span class="token keyword">MAINTAINER</span> dongzhang@gaoshan.co
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y gnupg2 software<span class="token punctuation">-</span>properties<span class="token punctuation">-</span>common
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>key adv <span class="token punctuation">-</span><span class="token punctuation">-</span>keyserver keyserver.ubuntu.com <span class="token punctuation">-</span><span class="token punctuation">-</span>recv<span class="token punctuation">-</span>keys CE7709D068DB5E88 \
 &amp;&amp; add<span class="token punctuation">-</span>apt<span class="token punctuation">-</span>repository <span class="token string">&quot;deb https://repo.sovrin.org/sdk/deb bionic stable&quot;</span> \
 &amp;&amp; apt<span class="token punctuation">-</span>get update \
 &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y libindy

<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y openjdk<span class="token punctuation">-</span>8<span class="token punctuation">-</span>jdk \
 &amp;&amp; java <span class="token punctuation">-</span>version

<span class="token keyword">RUN</span> adduser indy \
 &amp;&amp; echo <span class="token string">'indy:indypasswd'</span> <span class="token punctuation">|</span> chpasswd \
 &amp;&amp; mkdir /app \
 &amp;&amp; chown <span class="token punctuation">-</span>R indy /app

<span class="token keyword">ADD</span> entrypoint.sh /usr/local/bin/

<span class="token keyword">RUN</span> chmod +x /usr/local/bin/entrypoint.sh

<span class="token keyword">USER</span> indy

<span class="token keyword">WORKDIR</span> /app

<span class="token keyword">VOLUME</span> /app
<span class="token keyword">EXPOSE</span> 8080

<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/local/bin/entrypoint.sh&quot;</span><span class="token punctuation">]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>docker-compose.yml 配置参考：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">cert-app-center</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> .
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wattazoum/springboot<span class="token punctuation">-</span>runner<span class="token punctuation">-</span>local
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>app<span class="token punctuation">-</span>center
  <span class="token comment">#  restart: always</span>
    <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8084<span class="token punctuation">:</span><span class="token number">8084</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./cert<span class="token punctuation">-</span>app<span class="token punctuation">-</span>center/logs<span class="token punctuation">:</span>/mnt/logs
      <span class="token punctuation">-</span> ./cert<span class="token punctuation">-</span>app<span class="token punctuation">-</span>center<span class="token punctuation">:</span>/app
      <span class="token punctuation">-</span> /etc/localtime<span class="token punctuation">:</span>/etc/localtime
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'TZ=&quot;Asia/Shanghai&quot;'</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> cert_default

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="遇到的问题"><a href="#遇到的问题" class="header-anchor">#</a> 遇到的问题</h2> <h3 id="permission-denied-unknown"><a href="#permission-denied-unknown" class="header-anchor">#</a> permission denied: unknown</h3> <p>OCI runtime create failed: container_linux.go:370: starting container process caused: exec: &quot;/usr/local/bin/entrypoint.sh&quot;: permission denied: unknown</p> <p>解决方案：
Dockerfile 增加 <code>RUN chmod +x /usr/local/bin/entrypoint.sh</code></p> <h3 id="source-not-found"><a href="#source-not-found" class="header-anchor">#</a> source: not found</h3> <p>解决方案：
修改 entrypoint.sh 文件头 #!/bin</p> <blockquote><p>例如，我装java，解压之后配置环境变量，因为用的是Docker ubuntu自带的终端执行的命令，所以修改的是~/.bashrc文件，修改完了之后要用source命令生效：
Source ~/.bashrc：报：/bin/sh: 28: source: not found
查了下，说是sh 和 bash 是不同的 shell，sh 中没有 source 命令，解决的方法是：
/bin/bash -c &quot;source 要执行的原内容”
若是要执行shell脚本中的该命令，则在 shell 脚本的第一行加上一行 &quot;#!/bin/bash&quot; 即可。这一行指定了shell 脚本解释器的路径，而且这个指定路径 只能放在文件的第一行。</p></blockquote> <h3 id="启动报错-无法连接-nacos-mysql-等其他容器"><a href="#启动报错-无法连接-nacos-mysql-等其他容器" class="header-anchor">#</a> 启动报错，无法连接 nacos mysql 等其他容器</h3> <p>解决方案：
修改了 docker-compose.yml ，增加 networks 相关的配置</p> <p>原因尚不清楚，还有很多需要学习的；</p></div></section> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xiumu2017/VuePressParadise/edit/master/docs/book/IndySdkDockerImage.md" target="_blank" rel="noopener noreferrer">飞鸿踏雪泥</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/26/2021, 3:39:30 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/book/IndySdkDockerImage.html#解析-wattazoum-springboot-runner" class="sidebar-link reco-side-解析-wattazoum-springboot-runner" data-v-70334359>解析 wattazoum/springboot-runner</a></li><li class="level-2" data-v-70334359><a href="/book/IndySdkDockerImage.html#集成-springboot-runner-和-indy-sdk" class="sidebar-link reco-side-集成-springboot-runner-和-indy-sdk" data-v-70334359>集成 springboot-runner 和 indy-sdk</a></li><li class="level-2" data-v-70334359><a href="/book/IndySdkDockerImage.html#遇到的问题" class="sidebar-link reco-side-遇到的问题" data-v-70334359>遇到的问题</a></li><li class="level-3" data-v-70334359><a href="/book/IndySdkDockerImage.html#permission-denied-unknown" class="sidebar-link reco-side-permission-denied-unknown" data-v-70334359>permission denied: unknown</a></li><li class="level-3" data-v-70334359><a href="/book/IndySdkDockerImage.html#source-not-found" class="sidebar-link reco-side-source-not-found" data-v-70334359>source: not found</a></li><li class="level-3" data-v-70334359><a href="/book/IndySdkDockerImage.html#启动报错-无法连接-nacos-mysql-等其他容器" class="sidebar-link reco-side-启动报错-无法连接-nacos-mysql-等其他容器" data-v-70334359>启动报错，无法连接 nacos mysql 等其他容器</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.70f464a8.js" defer></script><script src="/assets/js/3.5e14ac70.js" defer></script><script src="/assets/js/1.b7eef7cf.js" defer></script><script src="/assets/js/12.e622fd0d.js" defer></script>
  </body>
</html>
